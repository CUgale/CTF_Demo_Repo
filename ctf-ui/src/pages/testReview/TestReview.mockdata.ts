import { TestReviewData } from './TestReview.interface';

// Test Review Data for Test Generation Phase (phase-3) - No push to git during this phase
export const mockTestReviewData: TestReviewData = {
  jobId: 'job-002',
  phaseId: 'phase-3',
  totalTests: 18,
  approvedTests: 8,
  rejectedTests: 2,
  pendingTests: 8,
  // Note: gitMetadata not included during Test Generation phase - push to git only available in Test Execution phase
  tests: [
    {
      id: 'test-001',
      name: 'customers_customer_id_not_null',
      type: 'not_null',
      model: 'customers',
      column: 'customer_id',
      sql: `-- Test: Validate customer_id is not null
-- Generated by AI based on schema analysis
-- This test ensures data integrity for the primary key

WITH validation AS (
    SELECT
        customer_id,
        first_name,
        last_name,
        email,
        created_at,
        updated_at
    FROM {{ ref('customers') }}
    WHERE customer_id IS NULL
       OR TRIM(CAST(customer_id AS STRING)) = ''
)

SELECT
    'customer_id_null_check' AS test_name,
    COUNT(*) AS failure_count,
    CURRENT_TIMESTAMP() AS tested_at
FROM validation
WHERE customer_id IS NULL`,
      description: 'Ensures customer_id column does not contain null values. This is critical for maintaining referential integrity across the data warehouse.',
      status: 'approved',
      generatedAt: '2024-01-15T11:07:15Z',
      generatedBy: 'GPT-4',
      source: 'ai',
      // Note: isPushed should be false during Test Generation phase - push only in Test Execution phase
    },
    {
      id: 'test-002',
      name: 'customers_email_unique',
      type: 'unique',
      model: 'customers',
      column: 'email',
      sql: `-- Test: Validate email uniqueness across customers
-- Duplicate emails can cause authentication issues

WITH email_counts AS (
    SELECT
        LOWER(TRIM(email)) AS normalized_email,
        COUNT(*) AS occurrence_count,
        ARRAY_AGG(customer_id ORDER BY created_at) AS customer_ids
    FROM {{ ref('customers') }}
    WHERE email IS NOT NULL
      AND TRIM(email) != ''
    GROUP BY LOWER(TRIM(email))
    HAVING COUNT(*) > 1
)

SELECT
    normalized_email,
    occurrence_count,
    customer_ids,
    'Email uniqueness violation detected' AS error_message
FROM email_counts
ORDER BY occurrence_count DESC`,
      description: 'Ensures email column contains unique values to prevent duplicate customer accounts.',
      status: 'approved',
      generatedAt: '2024-01-15T11:07:20Z',
      generatedBy: 'GPT-4',
      source: 'ai',
      // Note: isPushed should be false during Test Generation phase
    },
    {
      id: 'test-003',
      name: 'orders_order_id_not_null',
      type: 'not_null',
      model: 'orders',
      column: 'order_id',
      sql: `-- Test: Validate order_id primary key integrity
-- Orders without valid IDs cannot be tracked or processed

SELECT
    o.*,
    c.customer_name,
    p.product_name
FROM {{ ref('orders') }} o
LEFT JOIN {{ ref('customers') }} c ON o.customer_id = c.customer_id
LEFT JOIN {{ ref('products') }} p ON o.product_id = p.product_id
WHERE o.order_id IS NULL
   OR o.order_id <= 0`,
      description: 'Ensures order_id column does not contain null values for proper order tracking.',
      status: 'pending',
      generatedAt: '2024-01-15T11:07:25Z',
      generatedBy: 'GPT-4',
      source: 'ai',
    },
    {
      id: 'test-004',
      name: 'orders_customer_id_relationships',
      type: 'relationships',
      model: 'orders',
      column: 'customer_id',
      sql: `-- Test: Validate referential integrity between orders and customers
-- All orders must have a valid customer reference

WITH orphaned_orders AS (
    SELECT
        o.order_id,
        o.customer_id AS order_customer_id,
        o.order_date,
        o.total_amount,
        o.status AS order_status,
        c.customer_id AS matched_customer_id
    FROM {{ ref('orders') }} o
    LEFT JOIN {{ ref('customers') }} c 
        ON o.customer_id = c.customer_id
    WHERE c.customer_id IS NULL
      AND o.customer_id IS NOT NULL
)

SELECT
    order_id,
    order_customer_id,
    order_date,
    total_amount,
    order_status,
    'Orphaned order - customer not found' AS validation_error
FROM orphaned_orders
ORDER BY order_date DESC
LIMIT 1000`,
      description: 'Ensures customer_id in orders table references valid customers for data consistency.',
      status: 'approved',
      generatedAt: '2024-01-15T11:07:30Z',
      generatedBy: 'GPT-4',
      source: 'ai',
    },
    {
      id: 'test-005',
      name: 'products_status_accepted_values',
      type: 'accepted_values',
      model: 'products',
      column: 'status',
      sql: `-- Test: Validate product status values
-- Only predefined status values are allowed in the system

WITH invalid_statuses AS (
    SELECT
        product_id,
        product_name,
        status,
        category,
        price,
        created_at,
        updated_at
    FROM {{ ref('products') }}
    WHERE status NOT IN (
        'active',
        'inactive', 
        'discontinued',
        'pending_review',
        'out_of_stock'
    )
    OR status IS NULL
)

SELECT
    product_id,
    product_name,
    status AS invalid_status,
    'Status value not in accepted list' AS error_type,
    CURRENT_TIMESTAMP() AS checked_at
FROM invalid_statuses`,
      description: 'Ensures status column only contains accepted values from the predefined list.',
      status: 'rejected',
      generatedAt: '2024-01-15T11:07:35Z',
      generatedBy: 'GPT-4',
      source: 'ai',
    },
    {
      id: 'test-006',
      name: 'customers_age_range',
      type: 'custom',
      model: 'customers',
      column: 'age',
      sql: `-- Test: Validate customer age is within realistic bounds
-- Age should be between 0 and 120 years

WITH age_validation AS (
    SELECT
        customer_id,
        first_name,
        last_name,
        email,
        age,
        date_of_birth,
        CASE
            WHEN age < 0 THEN 'Age is negative'
            WHEN age > 120 THEN 'Age exceeds maximum'
            WHEN age < 13 THEN 'Age below minimum for account'
            ELSE 'Valid'
        END AS validation_result
    FROM {{ ref('customers') }}
    WHERE age < 0 
       OR age > 120
       OR age IS NULL
)

SELECT
    customer_id,
    first_name || ' ' || last_name AS full_name,
    email,
    age,
    date_of_birth,
    validation_result
FROM age_validation
WHERE validation_result != 'Valid'
ORDER BY age DESC NULLS FIRST`,
      description: 'Ensures age is within valid range (0-120) for data quality and compliance.',
      status: 'rejected',
      generatedAt: '2024-01-15T11:07:40Z',
      generatedBy: 'GPT-4',
      source: 'ai',
    },
    {
      id: 'test-007',
      name: 'customers_first_name_not_null',
      type: 'not_null',
      model: 'customers',
      column: 'first_name',
      sql: `SELECT * FROM {{ ref('customers') }} WHERE first_name IS NULL`,
      description: 'Ensures first_name column does not contain null values.',
      status: 'approved',
      generatedAt: '2024-01-15T11:07:45Z',
      generatedBy: 'GPT-4',
      source: 'ai',
    },
    {
      id: 'test-008',
      name: 'customers_last_name_not_null',
      type: 'not_null',
      model: 'customers',
      column: 'last_name',
      sql: `SELECT * FROM {{ ref('customers') }} WHERE last_name IS NULL`,
      description: 'Ensures last_name column does not contain null values.',
      status: 'pending',
      generatedAt: '2024-01-15T11:07:50Z',
      generatedBy: 'GPT-4',
      source: 'ai',
    },
    {
      id: 'test-009',
      name: 'customers_created_at_not_null',
      type: 'not_null',
      model: 'customers',
      column: 'created_at',
      sql: `SELECT * FROM {{ ref('customers') }} WHERE created_at IS NULL`,
      description: 'Ensures created_at timestamp is always present.',
      status: 'pending',
      generatedAt: '2024-01-15T11:07:55Z',
      generatedBy: 'GPT-4',
      source: 'ai',
    },
    {
      id: 'test-010',
      name: 'orders_order_id_unique',
      type: 'unique',
      model: 'orders',
      column: 'order_id',
      sql: `SELECT order_id FROM {{ ref('orders') }} GROUP BY order_id HAVING COUNT(*) > 1`,
      description: 'Ensures order_id values are unique across all orders.',
      status: 'approved',
      generatedAt: '2024-01-15T11:08:00Z',
      generatedBy: 'GPT-4',
      source: 'ai',
    },
    {
      id: 'test-011',
      name: 'products_product_id_unique',
      type: 'unique',
      model: 'products',
      column: 'product_id',
      sql: `SELECT product_id FROM {{ ref('products') }} GROUP BY product_id HAVING COUNT(*) > 1`,
      description: 'Ensures product_id values are unique.',
      status: 'approved',
      generatedAt: '2024-01-15T11:08:05Z',
      generatedBy: 'GPT-4',
      source: 'ai',
    },
    {
      id: 'test-012',
      name: 'products_sku_unique',
      type: 'unique',
      model: 'products',
      column: 'sku',
      sql: `SELECT sku FROM {{ ref('products') }} WHERE sku IS NOT NULL GROUP BY sku HAVING COUNT(*) > 1`,
      description: 'Ensures SKU codes are unique across products.',
      status: 'pending',
      generatedAt: '2024-01-15T11:08:10Z',
      generatedBy: 'GPT-4',
      source: 'ai',
    },
    {
      id: 'test-013',
      name: 'orders_product_id_relationships',
      type: 'relationships',
      model: 'orders',
      column: 'product_id',
      sql: `SELECT * FROM {{ ref('orders') }} o LEFT JOIN {{ ref('products') }} p ON o.product_id = p.product_id WHERE p.product_id IS NULL AND o.product_id IS NOT NULL`,
      description: 'Ensures all orders reference valid products.',
      status: 'pending',
      generatedAt: '2024-01-15T11:08:15Z',
      generatedBy: 'GPT-4',
      source: 'ai',
    },
    {
      id: 'test-014',
      name: 'transactions_order_id_relationships',
      type: 'relationships',
      model: 'transactions',
      column: 'order_id',
      sql: `SELECT * FROM {{ ref('transactions') }} t LEFT JOIN {{ ref('orders') }} o ON t.order_id = o.order_id WHERE o.order_id IS NULL AND t.order_id IS NOT NULL`,
      description: 'Ensures all transactions reference valid orders.',
      status: 'pending',
      generatedAt: '2024-01-15T11:08:20Z',
      generatedBy: 'GPT-4',
      source: 'ai',
    },
    {
      id: 'test-015',
      name: 'transactions_customer_id_relationships',
      type: 'relationships',
      model: 'transactions',
      column: 'customer_id',
      sql: `SELECT * FROM {{ ref('transactions') }} t LEFT JOIN {{ ref('customers') }} c ON t.customer_id = c.customer_id WHERE c.customer_id IS NULL AND t.customer_id IS NOT NULL`,
      description: 'Ensures all transactions reference valid customers.',
      status: 'pending',
      generatedAt: '2024-01-15T11:08:25Z',
      generatedBy: 'GPT-4',
      source: 'ai',
    },
    {
      id: 'test-016',
      name: 'orders_status_accepted_values',
      type: 'accepted_values',
      model: 'orders',
      column: 'status',
      sql: `SELECT * FROM {{ ref('orders') }} WHERE status NOT IN ('pending', 'processing', 'completed', 'cancelled', 'refunded')`,
      description: 'Ensures order status only contains accepted values.',
      status: 'approved',
      generatedAt: '2024-01-15T11:08:30Z',
      generatedBy: 'GPT-4',
      source: 'ai',
    },
    {
      id: 'test-017',
      name: 'customers_segment_accepted_values',
      type: 'accepted_values',
      model: 'customers',
      column: 'segment',
      sql: `SELECT * FROM {{ ref('customers') }} WHERE segment NOT IN ('Enterprise', 'SMB', 'Startup', 'Individual')`,
      description: 'Ensures customer segment only contains accepted values.',
      status: 'pending',
      generatedAt: '2024-01-15T11:08:35Z',
      generatedBy: 'GPT-4',
      source: 'ai',
    },
    {
      id: 'test-018',
      name: 'products_category_accepted_values',
      type: 'accepted_values',
      model: 'products',
      column: 'category',
      sql: `SELECT * FROM {{ ref('products') }} WHERE category NOT IN ('Software', 'Service', 'Hardware', 'Subscription')`,
      description: 'Ensures product category only contains accepted values.',
      status: 'approved',
      generatedAt: '2024-01-15T11:08:40Z',
      generatedBy: 'GPT-4',
      source: 'ai',
    },
  ],
};

